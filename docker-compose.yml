services:
  openclaw:
    container_name: openclaw-agentic
    build:
      context: .
      args:
        EXTRA_APT_PACKAGES: ""  # Add apt packages here, e.g. "python3 python3-pip"
    ports:
      - "${OPENCLAW_BIND_HOST:-127.0.0.1}:18789:18789"
    volumes:
      - ./data:/root/.openclaw        # Persistent config + conversations
      - ./workspace:/root/openclaw        # Workspace + skills
    environment:
      - OPENCLAW_GATEWAY_TOKEN=${OPENCLAW_GATEWAY_TOKEN}
      - DISCORD_BOT_TOKEN=${DISCORD_BOT_TOKEN}
      - OLLAMA_BASE_URL=${OLLAMA_BASE_URL}
      - OLLAMA_MODEL=${OLLAMA_MODEL}
      - OLLAMA_API_KEY=ollama-local
      # Browser sidecar
      - BROWSER_CDP_URL=http://browser:9223
      - BROWSER_DEFAULT_PROFILE=openclaw
      - BROWSER_EVALUATE_ENABLED=true
    restart: unless-stopped

  # The Browser Service (Remote CDP Endpoint)
  browser:
    image: ghcr.io/openclaw/openclaw-browser:latest # Use latest for 2026 stability
    environment:
      - PUID=1000
      - PGID=1000
      - TZ=Europe/Brussels
      - CHROME_CLI=--remote-debugging-port=9222 --no-sandbox --disable-gpu --disable-software-rasterizer
      - SCREEN_WIDTH=1280
      - SCREEN_HEIGHT=720
      - SCREEN_DEPTH=24
    volumes:
      - ./browser-data:/root/.config/chromium # Persists logins/cookies
    shm_size: 2g
    restart: unless-stopped
