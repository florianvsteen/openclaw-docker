services:
  openclaw:
    container_name: openclaw-agentic
    build:
      context: .
      args:
        EXTRA_APT_PACKAGES: ""  # Add apt packages here, e.g. "python3 python3-pip"
    ports:
      - "${OPENCLAW_BIND_HOST:-127.0.0.1}:18789:18789"
    volumes:
      - ./data:/root/.openclaw        # Persistent config + conversations
      - ./workspace:/root/openclaw        # Workspace + skills
    environment:
      - OPENCLAW_GATEWAY_TOKEN=${OPENCLAW_GATEWAY_TOKEN}
      - DISCORD_BOT_TOKEN=${DISCORD_BOT_TOKEN}
      - OLLAMA_BASE_URL=${OLLAMA_BASE_URL}
      - OLLAMA_MODEL=${OLLAMA_MODEL}
      - OLLAMA_API_KEY=ollama-local
      # Browser sidecar
      - BROWSER_CDP_URL=http://browser:3000
      - BROWSER_DEFAULT_PROFILE=openclaw
      - BROWSER_EVALUATE_ENABLED=true
      - OPENCLAW_BROWSER_MODE=remote
      - OPENCLAW_SECURITY_ALLOW_SCREENSHOTS=true
    restart: unless-stopped

  # The Browser Service (Remote CDP Endpoint)
  browser:
    container_name: openclaw-browser
    image: ghcr.io/browserless/chromium:latest
    ports:
      - "3000:3000"
    volumes:
      - ./browser-data:/root/.config/chromium # Persists logins/cookies
    shm_size: 2g
    restart: unless-stopped
